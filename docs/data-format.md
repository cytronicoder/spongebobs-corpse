# Data Format

## Overview

This document describes the expected format for input and intermediate data files used in the impact attenuation analysis.

## Raw Data Files

### Location
`data/` directory

### Format
CSV files with force-time measurements from impact experiments.

### Naming Convention
Files should include thickness information in the filename:
- `experiment - 4mm.csv`
- `experiment - 40mm.csv`
- `experiment - 52mm.csv`

The thickness value will be automatically extracted using the pattern `(\d+(?:\.\d+)?)\s*mm`.

### Structure
Raw data files typically contain:
- **Time column**: Timestamps in seconds
- **Force column**: Force measurements in Newtons
- **Multiple runs**: Separate columns for repeated trials

Example:
```csv
Time (s),Run 1 Force (N),Run 2 Force (N),Run 3 Force (N)
0.000,0.0,0.1,0.0
0.001,0.2,0.3,0.1
0.002,1.5,1.4,1.6
...
```

## Aligned Data Files

### Location
`outputs/<experiment_name>/` directories

### Generated By
Data alignment preprocessing step (not included in this repository)

### Format
CSV files with multi-level column headers containing aligned force-time data.

### Filename Convention
`<experiment_name>_aligned.csv`

Example: `dr lee go brr - 4mm_aligned.csv`

### Structure

Multi-level column structure:
- **Level 1 (Run identifier)**: `Run 1`, `Run 2`, ..., `Latest`
- **Level 2 (Data type)**: `time_s`, `force_N`, `velocity_m/s` (optional), `energy_J` (optional)

Example structure:
```csv
Run 1,Run 1,Run 2,Run 2,Run 3,Run 3
time_s,force_N,time_s,force_N,time_s,force_N
0.000,0.0,0.000,0.1,0.000,0.0
0.001,0.2,0.001,0.3,0.001,0.1
0.002,1.5,0.002,1.4,0.002,1.6
...
```

### Data Alignment
- All runs are aligned so that peak force occurs at the same time point
- This facilitates comparison across trials
- Alignment preserves the relative timing of contact events

### Required Columns
For each run:
- `time_s`: Time in seconds (required)
- `force_N`: Force in Newtons (required)
- `velocity_m/s`: Velocity in m/s (optional, for velocity-based method)
- `energy_J`: Energy in Joules (optional, for energy-based method)

## Contact Duration Results

### Detailed Results

**Filename**: `contact_duration_detailed.csv`

**Location**: `outputs/contact_analysis_<threshold>/`

**Columns**:
- `filename`: Source data file
- `thickness_mm`: Pad thickness in millimeters
- `run`: Run identifier (Run 1, Run 2, etc.)
- `duration_s`: Contact duration in seconds
- `peak_force_N`: Peak force in Newtons
- `start_time_s`: Contact start time
- `end_time_s`: Contact end time
- `threshold_force_N`: Threshold value used for detection
- `method`: Detection method used

**Example**:
```csv
filename,thickness_mm,run,duration_s,peak_force_N,start_time_s,end_time_s,threshold_force_N,method
dr lee go brr - 4mm_aligned.csv,4.0,Run 1,0.0234,45.2,0.098,0.1214,2.26,threshold
dr lee go brr - 4mm_aligned.csv,4.0,Run 2,0.0228,44.8,0.099,0.1218,2.24,threshold
...
```

### Summary Statistics

**Filename**: `contact_duration_summary.csv`

**Location**: `outputs/contact_analysis_<threshold>/`

**Columns**:
- `filename`: Source data file
- `thickness_mm`: Pad thickness in millimeters
- `n_runs`: Number of successful runs analyzed
- `duration_s_mean`: Mean contact duration
- `duration_s_std`: Standard deviation of contact duration
- `duration_s_cv`: Coefficient of variation (%)
- `peak_force_N_mean`: Mean peak force
- `peak_force_N_std`: Standard deviation of peak force
- `peak_force_N_cv`: Coefficient of variation (%)

**Example**:
```csv
filename,thickness_mm,n_runs,duration_s_mean,duration_s_std,duration_s_cv,peak_force_N_mean,peak_force_N_std,peak_force_N_cv
dr lee go brr - 4mm_aligned.csv,4.0,5,0.0231,0.0003,1.30,45.0,0.5,1.11
dr lee go brr - 40mm_aligned.csv,40.0,5,0.0456,0.0012,2.63,28.3,0.8,2.83
...
```

### Formatted Summary Table

**Filename**: `summary_table_formatted.csv`

**Location**: `outputs/contact_analysis_<threshold>/`

**Purpose**: LaTeX-ready formatted table with uncertainties

**Columns**:
- `Thickness (mm)`: Pad thickness
- `Duration (s)`: Mean ± standard deviation
- `CV (%)`: Coefficient of variation
- `Peak Force (N)`: Mean ± standard deviation
- `CV (%)`: Coefficient of variation

**Example**:
```csv
Thickness (mm),Duration (s),CV (%),Peak Force (N),CV (%)
4,$0.0231 \pm 0.0003$,1.30,$45.0 \pm 0.5$,1.11
40,$0.0456 \pm 0.0012$,2.63,$28.3 \pm 0.8$,2.83
...
```

## Statistical Report

**Filename**: `statistical_report.txt`

**Location**: `outputs/contact_analysis_<threshold>/`

**Content**:
- Linear regression results (duration vs. thickness)
- Linear regression results (peak force vs. thickness)
- Coefficient of variation analysis
- Regression equation with uncertainties
- R² values and p-values
- Statistical significance assessments

**Example**:
```text
Contact Duration Analysis Statistical Report
============================================

Linear Regression: Duration vs Thickness
-----------------------------------------
Slope: (1.23 ± 0.04) × 10⁻⁴ s/mm
Intercept: (0.0198 ± 0.0015) s
R² = 0.987
p-value = 0.0023

The relationship is statistically significant (p < 0.05).

...
```

## Data Quality Requirements

### Minimum Requirements
- **At least 2 runs** per thickness for statistical analysis
- **Complete time series**: No large gaps in time data
- **Valid force measurements**: Non-negative values, reasonable magnitudes
- **Sufficient sampling rate**: Able to resolve contact duration (typically >1000 Hz)

### Data Validation
The scripts automatically validate:
- Presence of required columns
- Numeric data types
- Finite values (no NaN or Inf)
- Monotonically increasing time values
- Consistent sampling intervals

### Common Issues
1. **Missing data**: NaN values in force or time columns
   - **Solution**: Scripts interpolate small gaps, skip runs with excessive missing data

2. **Misaligned runs**: Peak forces not synchronized
   - **Solution**: Use alignment preprocessing before contact duration analysis

3. **Incorrect thickness extraction**: Filename doesn't match pattern
   - **Solution**: Ensure filename contains thickness as `XXmm` format

4. **Insufficient data points**: Very short time series
   - **Solution**: Check sampling rate and duration of data collection

## Unit Conventions

All data should use SI units:
- **Time**: seconds (s)
- **Force**: Newtons (N)
- **Velocity**: meters per second (m/s)
- **Energy**: Joules (J)
- **Thickness**: millimeters (mm)

## File Encoding

All CSV files should use:
- **Encoding**: UTF-8
- **Line endings**: Unix-style (LF) or Windows-style (CRLF)
- **Decimal separator**: Period (.)
- **Thousands separator**: None or comma (,)
